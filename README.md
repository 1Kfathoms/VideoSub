# VideoSub: 自動動画文字起こし＆翻訳プレーヤー

VideoSubは、英語の動画ファイルから自動的に字幕（文字起こし）と翻訳を作成し、ブラウザで視聴可能な学習用プレーヤーを生成するツールです。
OpenAIのWhisper（stable-ts）による高精度なタイムスタンプ取得と、Argos Translateによるオフライン翻訳を組み合わせています。

## 特徴

* **高精度な文字起こし**: `stable-ts` (Whisper) を使用し、単語レベルでの正確なタイムスタンプを取得。
* **自動翻訳**: 英語から日本語への翻訳をローカル環境で自動実行（Argos Translate使用）。
* **専用Webプレーヤー**:
    * 生成された `index.html` で即座に視聴可能。
    * 現在の発話箇所をハイライト表示。
    * 単語をクリックするとそのシーンへジャンプ。
    * 動画画面と字幕エリアの比率を自由にリサイズ可能。
    * 単語ホバーで辞書ツールチップを表示し、ホバー中は動画を自動一時停止。
    * ツールチップ上にマウスを移動しても表示が維持され、ホバー終了時に再生を再開。
    * ページ読込直後に自動再生を試行（ブラウザポリシーでブロックされた場合はミュート再生を試行）。
    * 検索ボックスはデスクトップでコンパクト表示、スマホでは字幕エリア上部に移動して動画にかぶらない配置。
* **簡単操作**: 動画ファイルをバッチファイルにドラッグ＆ドロップするだけ。

## ディレクトリ構造

```text
251225_VideoSub/
│
├── output/              (処理結果がここに生成される)
│   └── [動画ファイル名]/
│       ├── data.js      (字幕データ)
│       ├── index.html   (プレーヤー)
│       └── [動画ファイル]
├── templates/
│   └── player_template.html
├── process_video.py     (メイン処理スクリプト)
├── requirements.txt     (ライブラリ依存関係)
├── 01_setup.bat         (初回環境構築用)
└── 02_process.bat       (実行用ランチャー)
```
## 動作環境

* **OS**: Windows 10/11
* **Python管理**: Anaconda または Miniconda がインストールされていること
* **GPU**: NVIDIA GPU（CUDA対応）推奨
    * ※ `process_video.py` では `large-v3` モデルを指定しています。VRAMが少ない場合はコード内のモデルサイズを `medium` や `small` に変更してください。

## セットアップ（初回のみ）

1.  Anaconda Prompt (またはコマンドプロンプト) を開きます。
2.  `01_setup.bat` をダブルクリックして実行します。
    * 仮想環境 `video_learning_env` が作成されます。
    * 必要なライブラリ（PyTorch, Whisper, Argos Translate等）がインストールされます。
    * 完了後、キーを押してウィンドウを閉じます。

## 使い方

### 1. 動画の処理

1.  変換したい英語の動画ファイル（`.mp4`, `.mkv` 等）を用意します。
2.  動画ファイルを **`02_process.bat`** のアイコンの上に**ドラッグ＆ドロップ**します。
3.  黒い画面（コンソール）が立ち上がり、処理が始まります。
    * 初回実行時は翻訳モデルのダウンロードなどにより時間がかかる場合があります。
4.  「処理が完了しました」と表示されたらウィンドウを閉じます。

### 2. 視聴する（PC）

1.  `output` フォルダ内に、動画ファイル名と同名のフォルダが作成されています。
2.  その中の `index.html` をダブルクリックして開きます。
3.  ブラウザで動画と字幕が表示されます。

### プレーヤー操作のヒント

- 単語をクリック: その区間へシークして再生。
- 単語にホバー: 辞書ツールチップを表示。ホバー中は動画が一時停止し、ツールチップ上でも停止を維持。外れたら自動再開。
- 検索ボックス: 入力すると一致する単語を強調表示。スマホでは字幕エリア上部に配置され、動画に重なりません。
- リサイズハンドル: 動画と字幕の幅をドラッグで変更。

---

## 応用: スマホから視聴する (LAN内配信)

生成されたプレーヤーはWeb標準技術で作られているため、簡易サーバーを立てることで、同じWi-Fi内のスマートフォンやタブレットから視聴可能です。

1.  **コマンドプロンプトを開く**
    * `output` フォルダを開き、アドレスバーに `cmd` と入力してEnterを押すと、その場所で開けます。

2.  **サーバーを起動する**
    以下のコマンドを入力して実行します。
    ```bash
    python -m http.server 8000
    ```
    ※ Windowsファイアウォールの警告が出た場合は「アクセスを許可」してください。

3.  **PCのIPアドレスを確認する**
    * 別のコマンドプロンプトを開き、`ipconfig` と入力して実行します。
    * `IPv4 アドレス` の行を確認します（例: `192.168.1.15`）。

4.  **スマホからアクセスする**
    * スマホのブラウザ（SafariやChrome）を開きます。
    * URL欄に `http://[PCのIPアドレス]:8000` と入力します。
        * 例: `http://192.168.1.15:8000`
    * ファイル一覧が表示されるので、見たい動画のフォルダを選択し、`index.html` をタップします。

## 注意事項

* **処理時間**: 動画の長さやGPUの性能に依存します。`large-v3` モデルは高精度ですが重いため、処理が遅い場合はスクリプト内のモデル指定を変更してください。
* **翻訳精度**: オフライン翻訳（Argos Translate）を使用しているため、DeepLやGoogle翻訳に比べると精度が劣る場合があります。

## ライセンス / クレジット

* **Whisper**: OpenAI
* **stable-ts**: jianfch
* **Argos Translate**: argosopentech