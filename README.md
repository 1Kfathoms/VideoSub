# VideoSub: 自動動画文字起こし＆翻訳プレーヤー

VideoSubは、英語の動画ファイルから自動的に字幕（文字起こし）と翻訳を作成し、ブラウザで視聴可能な学習用プレーヤーを生成するツールです。
OpenAIのWhisper（stable-ts）による高精度なタイムスタンプ取得と、Argos Translateによるオフライン翻訳を組み合わせています。

## 特徴

* **高精度な文字起こし**: `stable-ts` (Whisper) を使用し、単語レベルでの正確なタイムスタンプを取得します。
* **自動翻訳**: 英語から日本語への翻訳をローカル環境で自動実行します。
* **専用Webプレーヤー**:
    * **学習最適化UI**:
        * 生成された `index.html` で即座に視聴可能です。
        * 発話箇所をリアルタイムでハイライトし、単語クリックでその地点へジャンプ再生します。
        * 動画画面と字幕エリアの比率を自由にリサイズ可能です。
        * 「◫ サイドバー」ボタンにより、字幕リストの表示・非表示を切り替えて動画に集中できます。
    * **画面内字幕（オーバーレイ）**:
        * 動画上にも字幕を直接表示。ドラッグ＆ドロップで好きな位置へ配置できます。
        * 設定パネルから英語・日本語の表示/非表示を個別に切り替え可能です。
    * **辞書＆学習機能**:
        * 単語ホバーで英英辞書を表示し、自動的に動画を一時停止します。
        * 🔊ボタンで単語の発音再生、⏱️ボタンで単語の開始時間をコピーできます。
    * **検索・ナビゲーション**:
        * 単語検索ボックスで該当箇所を瞬時に検索し、ハイライト表示と自動スクロールを行います。
        * キーボードショートカット（A/S/D/矢印キー）による直感的な操作が可能です。
    * **Picture-in-Picture (PiP)**:
        * ⧉ PiPボタンで別ウィンドウ表示。PiPウィンドウ内でも辞書や検索など全機能が利用可能です。

## ディレクトリ構造

```text
251225_VideoSub/
│
├── output/              (処理結果がここに生成される)
│   └── [動画ファイル名]/
│       ├── data.js      (字幕データ)
│       ├── index.html   (プレーヤー)
│       └── [動画ファイル]
├── templates/
│   └── player_template.html
├── process_video.py     (メイン処理スクリプト)
├── requirements.txt     (ライブラリ依存関係)
├── 01_setup.bat         (初回環境構築用)
└── 02_process.bat       (実行用ランチャー)
```
## 動作環境

* **OS**: Windows 10/11
* **Python管理**: Anaconda または Miniconda がインストールされていること
* **GPU**: NVIDIA GPU（CUDA対応）推奨
    * ※ `process_video.py` では `large-v3` モデルを指定しています。VRAMが少ない場合はコード内のモデルサイズを `medium` や `small` に変更してください。

## セットアップ（初回のみ）

1.  Anaconda Prompt (またはコマンドプロンプト) を開きます。
2.  `01_setup.bat` をダブルクリックして実行します。
    * 仮想環境 `video_learning_env` が作成されます。
    * 必要なライブラリ（PyTorch, Whisper, Argos Translate等）がインストールされます。
    * 完了後、キーを押してウィンドウを閉じます。

## 使い方

### 1. 動画の処理

1.  変換したい英語の動画ファイル（`.mp4`, `.mkv` 等）を用意します。
2.  動画ファイルを **`02_process.bat`** のアイコンの上に**ドラッグ＆ドロップ**します。
3.  コンソールが立ち上がり、処理が始まります。
    * 初回実行時は翻訳モデルのダウンロードなどにより時間がかかる場合があります。
4.  「処理が完了しました」と表示されたらウィンドウを閉じます。

### 2. 視聴する（PC）

1.  `output` フォルダ内に、動画ファイル名と同名のフォルダが作成されています。
2.  その中の `index.html` をダブルクリックして開きます。
3.  ブラウザで動画と字幕が表示されます。

### プレーヤー操作のヒント

#### 表示レイアウトとカスタマイズ
- **サイドバー切替**: 「◫ サイドバー」ボタンをクリックすることで、右側の字幕リストの表示・非表示を切り替え、動画を全幅で表示できます。
- **画面内字幕（オーバーレイ）**: 動画上にも直接字幕が表示されます。この字幕はマウスで自由にドラッグして配置を変更可能です。
- **表示設定（⚙️ボタン）**: 設定パネルから、画面内字幕の「英語」「日本語」それぞれの表示/非表示を個別に切り替えられます。また、A- / A+ ボタンで字幕の文字サイズ（10px～32px）を調整できます。
- **リサイズ**: 動画エリアと字幕エリアの境界線をドラッグすることで、表示比率を自由に変更できます。

#### 学習・コピー機能
- **英英辞書ホバー**: 単語にマウスを合わせると、英英辞書ツールチップが表示され、動画が自動的に一時停止します。マウスを離すと再生が再開されます。
- **音声再生と時間コピー**: ツールチップ内の🔊ボタンで単語の発音を確認でき、⏱️ボタンでその単語の開始時間をコピーできます。
- **セグメント操作**: 各字幕ブロックの右側にある📋ボタンで英文テキストを、⏱️ボタンで開始秒数をクリップボードにコピーできます。

#### 検索機能
- **検索ボックス**: 単語を入力すると該当箇所が黄色くハイライトされます。▲/▼ボタンまたはEnterキーで、該当箇所へ自動スクロールしながら順次移動できます。

#### キーボードショートカット
- `←` / `→` : 5秒戻る / 進む
- `S` : 現在のセグメントの先頭へジャンプ
- `A` / `D` : 前 / 次のセグメントへ移動

#### Picture-in-Picture (PiP)
- **⧉ PiPボタン**: 独立した小窓で動画を表示します。PiPウィンドウ内でも、辞書表示、検索、表示設定などの全機能が最適化されたレイアウトで利用可能です。

---

## 応用: スマホから視聴する (LAN内配信)

1.  **サーバーを起動**: `output` フォルダでコマンドプロンプトを開き、`python -m http.server 8000` を実行します。
2.  **IPアドレスの確認**: PCのコマンドプロンプトで `ipconfig` を実行し、IPv4 アドレスを確認します。
3.  **スマホでアクセス**: スマホのブラウザで `http://[PCのIPアドレス]:8000` にアクセスし、目的のフォルダの `index.html` を開きます。

## 注意事項

* **処理時間**: 動画の長さやGPUの性能に依存します。
* **翻訳精度**: オフライン翻訳（Argos Translate）を使用しているため、文脈によっては精度が異なる場合があります。
* **ブラウザ互換性**: 
    * PiP機能はChrome/Edge等のDocument PiP API対応ブラウザが必要です。
    * コピー機能はセキュリティ上、localhostまたはHTTPS環境でのみ動作します。

## ライセンス / クレジット

* **Whisper**: OpenAI
* **stable-ts**: jianfch
* **Argos Translate**: argosopentech