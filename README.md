# VideoSub: 自動動画文字起こし＆翻訳プレーヤー

VideoSubは、英語の動画ファイルから自動的に字幕（文字起こし）と翻訳を作成し、ブラウザで視聴可能な学習用プレーヤーを生成するツールです。
OpenAIのWhisper（stable-ts）による高精度なタイムスタンプ取得と、Argos Translateによるオフライン翻訳を組み合わせています。

## 特徴

* **高精度な文字起こし**: `stable-ts` (Whisper) を使用し、単語レベルでの正確なタイムスタンプを取得。
* **自動翻訳**: 英語から日本語への翻訳をローカル環境で自動実行（Argos Translate使用）。
* **専用Webプレーヤー**:
    * **基本機能**:
        * 生成された `index.html` で即座に視聴可能。
        * 現在の発話箇所をリアルタイムでハイライト表示。
        * 単語をクリックするとその箇所へジャンプして再生。
        * 動画画面と字幕エリアの比率を自由にリサイズ可能。
    * **辞書＆学習機能**:
        * 単語ホバーで英英辞書ツールチップを表示（自動的に動画を一時停止）。
        * ツールチップ上にマウスを移動しても表示が維持され、外れると自動再開。
        * 🔊ボタンで単語の発音を再生（Web Speech API使用）。
        * ⏱️ボタンで単語の開始時間をコピー（メモ作成に便利）。
    * **コピー機能**:
        * 📋ボタンでセグメントの英文テキストをクリップボードにコピー（単語間のスペース付き）。
        * ⏱️ボタンでセグメントの開始時間をコピー（秒単位）。
    * **検索機能**:
        * 単語検索ボックスで瞬時に該当箇所を検索。
        * ▲/▼ボタンまたはEnterキーで検索結果をナビゲート。
        * 一致した単語をハイライト表示し、自動スクロール。
    * **キーボードショートカット**:
        * `←` / `→` : 5秒戻る / 進む
        * `S` : 現在のセグメントの先頭へジャンプ
        * `A` : 前のセグメントへ
        * `D` : 次のセグメントへ
    * **Picture-in-Picture機能**:
        * ⧉ PiPボタンで別ウィンドウ表示（Document PiP API対応ブラウザのみ）。
        * PiPウィンドウでも全機能（辞書、検索、字幕）が利用可能。
    * **カスタマイズ**:
        * ⚙️ボタンから文字サイズを調整可能（A- / A+）。
        * ページ読込直後に自動再生を試行（ブラウザポリシーでブロックされた場合はミュート再生を試行）。
    * **レスポンシブデザイン**:
        * スマホでは縦配置に自動切替。
        * モバイルでは操作ボタンが常時表示。
* **簡単操作**: 動画ファイルをバッチファイルにドラッグ＆ドロップするだけ。

## ディレクトリ構造

```text
251225_VideoSub/
│
├── output/              (処理結果がここに生成される)
│   └── [動画ファイル名]/
│       ├── data.js      (字幕データ)
│       ├── index.html   (プレーヤー)
│       └── [動画ファイル]
├── templates/
│   └── player_template.html
├── process_video.py     (メイン処理スクリプト)
├── requirements.txt     (ライブラリ依存関係)
├── 01_setup.bat         (初回環境構築用)
└── 02_process.bat       (実行用ランチャー)
```
## 動作環境

* **OS**: Windows 10/11
* **Python管理**: Anaconda または Miniconda がインストールされていること
* **GPU**: NVIDIA GPU（CUDA対応）推奨
    * ※ `process_video.py` では `large-v3` モデルを指定しています。VRAMが少ない場合はコード内のモデルサイズを `medium` や `small` に変更してください。

## セットアップ（初回のみ）

1.  Anaconda Prompt (またはコマンドプロンプト) を開きます。
2.  `01_setup.bat` をダブルクリックして実行します。
    * 仮想環境 `video_learning_env` が作成されます。
    * 必要なライブラリ（PyTorch, Whisper, Argos Translate等）がインストールされます。
    * 完了後、キーを押してウィンドウを閉じます。

## 使い方

### 1. 動画の処理

1.  変換したい英語の動画ファイル（`.mp4`, `.mkv` 等）を用意します。
2.  動画ファイルを **`02_process.bat`** のアイコンの上に**ドラッグ＆ドロップ**します。
3.  黒い画面（コンソール）が立ち上がり、処理が始まります。
    * 初回実行時は翻訳モデルのダウンロードなどにより時間がかかる場合があります。
4.  「処理が完了しました」と表示されたらウィンドウを閉じます。

### 2. 視聴する（PC）

1.  `output` フォルダ内に、動画ファイル名と同名のフォルダが作成されています。
2.  その中の `index.html` をダブルクリックして開きます。
3.  ブラウザで動画と字幕が表示されます。

### プレーヤー操作のヒント

#### 基本操作
- **単語をクリック**: その箇所へシークして再生開始。
- **ドラッグでリサイズ**: 動画と字幕エリアの境界をドラッグして比率を変更。
- **⧉ PiPボタン**: 別ウィンドウで動画と字幕を同時に表示（Chrome等のDocument PiP対応ブラウザのみ）。

#### 学習機能
- **単語にホバー**: 
    - 英英辞書ツールチップを表示（自動的に動画が一時停止）。
    - ツールチップ内の🔊ボタンで単語の発音を再生。
    - ツールチップ内の⏱️ボタンで単語の開始時間をコピー。
    - ツールチップ上にマウスを移動しても表示が維持され、外れると自動的に再生を再開。

#### コピー機能（各セグメントの右側に表示）
- **📋ボタン**: そのセグメントの英文テキストをコピー（単語間のスペース付き）。
- **⏱️ボタン**: セグメントの開始時間（秒単位）をコピー。

#### 検索機能
- **検索ボックス**: 単語を入力すると該当箇所を黄色でハイライト。
- **▲/▼ボタン**: 前/次の検索結果へ移動（Enterキーでも次へ移動）。
- 検索結果は自動的にスクロールして画面中央に表示されます。

#### キーボードショートカット
（検索ボックス以外にフォーカスがある状態で使用）
- `←` / `→` : 5秒戻る / 進む
- `S` : 現在のセグメントの先頭へジャンプ
- `A` : 前のセグメントへ移動
- `D` : 次のセグメントへ移動

#### 設定
- **⚙️ボタン**: 設定パネルを開く。
- **A- / A+ボタン**: 字幕の文字サイズを調整（10px～32px）。

---

## 応用: スマホから視聴する (LAN内配信)

生成されたプレーヤーはWeb標準技術で作られているため、簡易サーバーを立てることで、同じWi-Fi内のスマートフォンやタブレットから視聴可能です。

1.  **コマンドプロンプトを開く**
    * `output` フォルダを開き、アドレスバーに `cmd` と入力してEnterを押すと、その場所で開けます。

2.  **サーバーを起動する**
    以下のコマンドを入力して実行します。
    ```bash
    python -m http.server 8000
    ```
    ※ Windowsファイアウォールの警告が出た場合は「アクセスを許可」してください。

3.  **PCのIPアドレスを確認する**
    * 別のコマンドプロンプトを開き、`ipconfig` と入力して実行します。
    * `IPv4 アドレス` の行を確認します（例: `192.168.1.15`）。

4.  **スマホからアクセスする**
    * スマホのブラウザ（SafariやChrome）を開きます。
    * URL欄に `http://[PCのIPアドレス]:8000` と入力します。
        * 例: `http://192.168.1.15:8000`
    * ファイル一覧が表示されるので、見たい動画のフォルダを選択し、`index.html` をタップします。

## 注意事項

* **処理時間**: 動画の長さやGPUの性能に依存します。`large-v3` モデルは高精度ですが重いため、処理が遅い場合はスクリプト内のモデル指定を変更してください。
* **翻訳精度**: オフライン翻訳（Argos Translate）を使用しているため、DeepLやGoogle翻訳に比べると精度が劣る場合があります。
* **ブラウザ互換性**:
    * Picture-in-Picture機能はChrome/Edge等のDocument PiP API対応ブラウザでのみ利用可能です。
    * クリップボードコピー機能はHTTPSまたはlocalhostで動作します。

## ライセンス / クレジット

* **Whisper**: OpenAI
* **stable-ts**: jianfch
* **Argos Translate**: argosopentech